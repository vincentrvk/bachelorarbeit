Du sollst ein Skript für die Integration von S4/HANA mit ICI (Sell Side). Es sollen Produkt Masterdaten in ICI importiert werden. 

1. Header, Properties und Body
--------------------
Headers:

Properties:
requestUser = 
requestPassword = 
requestURL = 
RecipientBusinessSystemID_config = Icertis_SELL
RecipientBusinessSystemID_payload = //RecipientBusinessSystemID
SenderBusinessSystemID = //SenderBusinessSystemID

Für jedes Produkt einzeln:
ProductGroupInternalID = //ProductGroupInternalID
ProductInternalID = //ProductInternalID


Sollten Properties und Header bereits im Message-Objekt vorhanden sein, befülle die Variablen mit den vorhandenen Werten. Ist ein Wert nicht zu finden benutze "placeholder".


2. Eingehenden Payload speichern:
-------------------------------
- Speichere den eingehenden Payload für die spätere Verarbeitung


3. Splitter für Produkte
------------------------
- Filtere den Payload für das "Product"-Tag und verarbeite jedes Produkt einzeln


4. Filter ProductInternalID:
----------------------------
- Validiere die Produkte gemäß den Validierungsregeln


5. Request "Check if Product exists":
-----------------
Adresse: ${property.requestURL}
Methode: GET
Authentifizierung: Basic-Authentication
Header: keine
Query: ${property.ProductInternalID}
Body: keiner

Response Handling: 
- Wenn der eingehende Body kein PRODUCT-Objekt enthält, existiert das Produkt nicht -> CREATE
- Wenn der eingehende Body ein PRODUCT-Objekt enthält, existiert das Produkt -> UPDATE
- Entscheide hiernach welchen der folgenden beiden Requests benutzt wird (Schritte 6a oder 6b)


6a. Request "UPDATE Product":
-----------------
Adresse: ${property.requestURL}/Update
Methode: POST
Authentifizierung: Basic-Authentication
Header: keine
Body: Payload nach Request-Mapping Product

Response Handling: 
- kein Response Handling


6b. Request "CREATE Product":
-----------------
Adresse: ${property.requestURL}/Create
Methode: POST
Authentifizierung: Basic-Authentication
Header: keine
Body: Payload nach Request-Mapping Product

Response Handling: 
- kein Response Handling


7. Request "Set Active Status":
-----------------
Adresse: ${property.requestURL}/${property.ProductInternalID}/Activate
Methode: POST
Authentifizierung: Basic-Authentication
Header: keine
Body: Payload nach Request-Mapping Product

Response Handling: 
- kein Response Handling


8. Logging:
------------
- Logge den Payload in folgenden Fällen als Attachment String
	- vor jeder Request
	- nach jeder Request
	- nach jedem Mapping
	- vor jedem Mapping



Modularität-Anforderungen:
1. Schreibe eine separate Funktion für jeden API-Call
2. Schreibe eine separate Funktion für das Mapping
3. Schreibe eine separate Funktion zum festlegen der Werte (Headers & Properties)
4. Schreibe eine separate Funktion für das Error Handling
5. Schreibe eine separate Funktion für das Logging


Validierungsregeln:
- Es werden nur Produkte mit Produktnummer höher als 999 verarbeitet (z.B. PROD1500, PROD1000)
- Ist kein Produkt mit Produktnummer höher als 999 vorhanden, wirf einen Fehler


Mapping-Anforderungen:
REQUEST-MAPPING (Products): 
Quellfeld -> Zielfeld
XML -> JSON

ProductInternalID -> Data.ICMProductCode

ProductTypeCode -> Data.ICMProductType

Description/Description -> Data.ICMProductName

ProductGroupInternalID -> Data.ICMProductCategoryName.DisplayValue

DeletedIndicator -> Data.isActive
Transformationsregel:
- Negiere den eingehenden Boolean (z.B. "true" -> "false")
- Case insensitive



RESPONSE-MAPPING:
Quellfeld -> Zielfeld
keins


---
Input:
FLOW INPUT:
<?xml version="1.0" encoding="UTF-8"?>
<ProductMDMBulkReplicateRequestMessage xmlns="http://sap.com/xi/APPL/Global2">
  <MessageHeader>
    <CreationDateTime>2025-05-28T12:00:00Z</CreationDateTime>
    <SenderBusinessSystemID>SYS_EXT_01</SenderBusinessSystemID>
    <RecipientBusinessSystemID>SYS_RECEIVER_002</RecipientBusinessSystemID>
  </MessageHeader>
  <ProductMDMReplicateRequestMessage>
    <MessageHeader>
      <CreationDateTime>2025-05-28T12:00:00Z</CreationDateTime>
    </MessageHeader>
    <Product>
      <ProductInternalID>PROD12345</ProductInternalID>
      <ProductTypeCode>FG</ProductTypeCode>
      <DeletedIndicator>true</DeletedIndicator>
      <ProductGroupInternalID>GRP789</ProductGroupInternalID>
		<Description>TestDescription</Description>
    </Product>
  </ProductMDMReplicateRequestMessage>
</ProductMDMBulkReplicateRequestMessage>


INPUT REQUEST MAPPING (Products):
<Product>
      <ProductInternalID>PROD12345</ProductInternalID>
      <ProductTypeCode>FG</ProductTypeCode>
      <DeletedIndicator>true</DeletedIndicator>
      <ProductGroupInternalID>GRP789</ProductGroupInternalID>
	  <Description>
		<Description>TestDescription</Description>
</Product>

INPUT RESPONSE MAPPING:
keins



Input-Schema:
FLOW INPUT SCHEMA:
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           targetNamespace="http://sap.com/xi/APPL/Global2"
           xmlns="http://sap.com/xi/APPL/Global2"
           elementFormDefault="qualified">
  <xs:element name="ProductMDMBulkReplicateRequestMessage">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="MessageHeader">
          <xs:complexType>
            <xs:sequence>
              <xs:element name="CreationDateTime" type="xs:dateTime"/>
              <xs:element name="SenderBusinessSystemID" type="xs:string"/>
              <xs:element name="RecipientBusinessSystemID" type="xs:string"/>
            </xs:sequence>
          </xs:complexType>
        </xs:element>
        <xs:element name="ProductMDMReplicateRequestMessage">
          <xs:complexType>
            <xs:sequence>
              <xs:element name="MessageHeader">
                <xs:complexType>
                  <xs:sequence>
                    <xs:element name="CreationDateTime" type="xs:dateTime"/>
                  </xs:sequence>
                </xs:complexType>
              </xs:element>
              <xs:element name="Product">
                <xs:complexType>
                  <xs:sequence>
                    <xs:element name="ProductInternalID" type="xs:string"/>
                    <xs:element name="ProductTypeCode" type="xs:string"/>
                    <xs:element name="DeletedIndicator" type="xs:boolean"/>
                    <xs:element name="ProductGroupInternalID" type="xs:string"/>
                    <xs:element name="Description">
                      <xs:complexType>
                        <xs:sequence>
                          <xs:element name="Description" type="xs:string"/>
                        </xs:sequence>
                      </xs:complexType>
                    </xs:element>
                  </xs:sequence>
                </xs:complexType>
              </xs:element>
            </xs:sequence>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
</xs:schema>



INPUT SCHEMA REQUEST MAPPING (Products):
<xs:schema xmlns:xs="http://www.w3.org/2001/XMLSchema"
           elementFormDefault="qualified"
           targetNamespace="http://example.com/product"
           xmlns="http://example.com/product">
  <xs:element name="Product">
    <xs:complexType>
      <xs:sequence>
        <xs:element name="ProductInternalID" type="xs:string"/>
        <xs:element name="ProductTypeCode" type="xs:string"/>
        <xs:element name="DeletedIndicator" type="xs:boolean"/>
        <xs:element name="ProductGroupInternalID" type="xs:string"/>
        <xs:element name="Description">
          <xs:complexType>
            <xs:sequence>
              <xs:element name="Description" type="xs:string"/>
            </xs:sequence>
          </xs:complexType>
        </xs:element>
      </xs:sequence>
    </xs:complexType>
  </xs:element>
</xs:schema>




INPUT SCHEMA RESPONSE MAPPING:
keins




Output: 
OUTPUT REQUEST MAPPING (Products):
{
  "Data": {
    "ICMProductName": "Beispielprodukt",
    "ICMProductType": "Standard",
    "ICMProductCode": "PRD-001",
    "isActive": "true",
    "ICMProductCategoryName": {
      "DisplayValue": "Kategorie A"
    }
  }
}




OUTPUT RESPONSE MAPPING:
keins



Output Schema:
OUTPUT SCHEMA REQUEST MAPPING (Products):
{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "type": "object",
  "properties": {
    "Data": {
      "type": "object",
      "properties": {
        "ICMProductName": {
          "type": "string"
        },
        "ICMProductType": {
          "type": "string"
        },
        "ICMProductCode": {
          "type": "string"
        },
        "isActive": {
          "type": "string",
          "enum": ["true", "false"]
        },
        "ICMProductCategoryName": {
          "type": "object",
          "properties": {
            "DisplayValue": {
              "type": "string"
            }
          },
          "required": ["DisplayValue"],
          "additionalProperties": false
        }
      },
      "required": [
        "ICMProductName",
        "ICMProductType",
        "ICMProductCode",
        "isActive",
        "ICMProductCategoryName"
      ],
      "additionalProperties": false
    }
  },
  "required": ["Data"],
  "additionalProperties": false
}




OUTPUT SCHEMA RESPONSE MAPPING:
keins



